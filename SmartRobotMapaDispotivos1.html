<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot LAFVIN 3D - Configuración de Sensores</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 280px;
            z-index: 100;
        }
        
        #controls h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .toggle-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            margin: 3px;
            font-size: 0.8em;
            transition: background 0.3s;
        }
        
        .toggle-btn:hover {
            background: #2980b9;
        }
        
        .toggle-btn.active {
            background: #e74c3c;
        }
        
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 400px;
            z-index: 100;
        }
        
        #instructions {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            max-width: 200px;
            z-index: 100;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8em;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="controls">
            <h3>Controles del Robot</h3>
            
            <div class="control-group">
                <label>Sensores Ultrasónicos:</label>
                <button class="toggle-btn active" id="btn-us-front">US Frontal</button>
                <button class="toggle-btn active" id="btn-us-side">US Lateral</button>
            </div>
            
            <div class="control-group">
                <label>Sensores Infrarrojos:</label>
                <button class="toggle-btn active" id="btn-ir-line">Line Tracking</button>
                <button class="toggle-btn active" id="btn-ir-side">IR Lateral</button>
                <button class="toggle-btn active" id="btn-ir-down">IR Inferior</button>
            </div>
            
            <div class="control-group">
                <label>Componentes:</label>
                <button class="toggle-btn active" id="btn-servos">Servos</button>
                <button class="toggle-btn active" id="btn-motors">Motores</button>
                <button class="toggle-btn active" id="btn-camera">Cámara</button>
            </div>
            
            <div class="control-group">
                <label>Visualización:</label>
                <button class="toggle-btn active" id="btn-rays">Rayos</button>
                <button class="toggle-btn active" id="btn-labels">Etiquetas</button>
            </div>
        </div>
        
        <div id="instructions">
            <h4>Controles de Vista</h4>
            <p><strong>Rotar:</strong> Click + arrastrar</p>
            <p><strong>Zoom:</strong> Rueda del mouse</p>
        </div>
        
        <div id="info">
            <h4>Robot LAFVIN SmartBot Challenge</h4>
            <p>Configuración optimizada para recolección de cubos</p>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <span>Ultrasónicos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>Infrarrojos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12;"></div>
                    <span>Brazo/Servos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60;"></div>
                    <span>Rayos de detección</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, robot;
        let components = {};
        let isMouseDown = false;
        let mouseX = 0, mouseY = 0;
        let robotRotationX = 0, robotRotationY = 0;
        
        function init() {
            // Crear escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            // Crear cámara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 4, 5);
            camera.lookAt(0, 0, 0);
            
            // Crear renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Luces
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Crear robot
            createRobot();
            
            // Configurar controles
            setupControls();
            
            // Crear suelo
            createGround();
            
            // Iniciar animación
            animate();
        }
        
        function createRobot() {
            robot = new THREE.Group();
            
            // Chasis principal
            const chassisGeo = new THREE.BoxGeometry(2.2, 0.25, 3.2);
            const chassisMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            const chassis = new THREE.Mesh(chassisGeo, chassisMat);
            chassis.position.y = 0.12;
            chassis.castShadow = true;
            robot.add(chassis);
            components.chassis = chassis;
            
            // Plataforma superior
            const platformGeo = new THREE.BoxGeometry(1.8, 0.1, 2.8);
            const platformMat = new THREE.MeshLambertMaterial({ color: 0x2c3e50 });
            const platform = new THREE.Mesh(platformGeo, platformMat);
            platform.position.y = 0.3;
            platform.castShadow = true;
            robot.add(platform);
            
            // Ruedas y motores
            components.motors = new THREE.Group();
            const wheelPositions = [
                { x: -1.2, z: 1.4 },
                { x: 1.2, z: 1.4 },
                { x: -1.2, z: -1.4 },
                { x: 1.2, z: -1.4 }
            ];
            
            wheelPositions.forEach(pos => {
                // Rueda
                const wheelGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.12, 16);
                const wheelMat = new THREE.MeshLambertMaterial({ color: 0xffd700 });
                const wheel = new THREE.Mesh(wheelGeo, wheelMat);
                wheel.position.set(pos.x, 0.25, pos.z);
                wheel.rotation.z = Math.PI / 2;
                wheel.castShadow = true;
                components.motors.add(wheel);
                
                // Motor
                const motorGeo = new THREE.BoxGeometry(0.15, 0.15, 0.2);
                const motorMat = new THREE.MeshLambertMaterial({ color: 0xf1c40f });
                const motor = new THREE.Mesh(motorGeo, motorMat);
                motor.position.set(pos.x, 0.25, pos.z);
                motor.castShadow = true;
                components.motors.add(motor);
            });
            robot.add(components.motors);
            
            // Arduino
            const arduinoGeo = new THREE.BoxGeometry(0.7, 0.08, 0.5);
            const arduinoMat = new THREE.MeshLambertMaterial({ color: 0x4a90e2 });
            const arduino = new THREE.Mesh(arduinoGeo, arduinoMat);
            arduino.position.set(0, 0.38, 0);
            arduino.castShadow = true;
            robot.add(arduino);
            
            // Brazo robótico y servos
            components.servos = new THREE.Group();
            
            // Servo 1 - Base
            const servo1Geo = new THREE.CylinderGeometry(0.12, 0.12, 0.15, 12);
            const servoMat = new THREE.MeshLambertMaterial({ color: 0xe74c3c });
            const servo1 = new THREE.Mesh(servo1Geo, servoMat);
            servo1.position.set(0, 0.45, 1.0);
            servo1.castShadow = true;
            components.servos.add(servo1);
            
            // Brazo principal
            const armGeo = new THREE.BoxGeometry(0.08, 0.08, 1.0);
            const armMat = new THREE.MeshLambertMaterial({ color: 0x34495e });
            const arm = new THREE.Mesh(armGeo, armMat);
            arm.position.set(0, 0.55, 1.5);
            arm.castShadow = true;
            components.servos.add(arm);
            
            // Servo 2 - Codo
            const servo2 = servo1.clone();
            servo2.position.set(0, 0.55, 2.0);
            components.servos.add(servo2);
            
            // Antebrazo
            const forearmGeo = new THREE.BoxGeometry(0.06, 0.8, 0.06);
            const forearm = new THREE.Mesh(forearmGeo, armMat);
            forearm.position.set(0, 0.95, 2.0);
            forearm.castShadow = true;
            components.servos.add(forearm);
            
            // Servo 3 - Pinza
            const servo3Geo = new THREE.BoxGeometry(0.1, 0.1, 0.08);
            const servo3 = new THREE.Mesh(servo3Geo, servoMat);
            servo3.position.set(0, 1.35, 2.0);
            servo3.castShadow = true;
            components.servos.add(servo3);
            
            // Pinza
            const gripperGeo = new THREE.BoxGeometry(0.08, 0.08, 0.12);
            const gripperMat = new THREE.MeshLambertMaterial({ color: 0xf39c12 });
            const gripper = new THREE.Mesh(gripperGeo, gripperMat);
            gripper.position.set(0, 1.43, 2.0);
            gripper.castShadow = true;
            components.servos.add(gripper);
            
            robot.add(components.servos);
            
            // Sensores
            createSensors();
            
            scene.add(robot);
        }
        
        function createSensors() {
            // Sensor ultrasónico frontal
            components.usFront = new THREE.Group();
            const usGeo = new THREE.BoxGeometry(0.18, 0.08, 0.06);
            const usMat = new THREE.MeshLambertMaterial({ color: 0x3498db });
            const usSensor = new THREE.Mesh(usGeo, usMat);
            usSensor.position.set(0, 0.25, 1.62);
            usSensor.castShadow = true;
            components.usFront.add(usSensor);
            
            // Rayo ultrasónico frontal
            const rayGeo = new THREE.CylinderGeometry(0.01, 0.01, 2.0, 8);
            const rayMat = new THREE.MeshBasicMaterial({ 
                color: 0x27ae60, 
                transparent: true, 
                opacity: 0.6 
            });
            const ray = new THREE.Mesh(rayGeo, rayMat);
            ray.position.set(0, 0.25, 2.62);
            ray.rotation.x = Math.PI / 2;
            components.usFront.add(ray);
            robot.add(components.usFront);
            
            // Sensor ultrasónico lateral
            components.usSide = new THREE.Group();
            const usSide = new THREE.Mesh(usGeo, usMat);
            usSide.position.set(1.12, 0.25, 0);
            usSide.rotation.y = Math.PI / 2;
            usSide.castShadow = true;
            components.usSide.add(usSide);
            
            const raySide = new THREE.Mesh(rayGeo, rayMat);
            raySide.position.set(2.12, 0.25, 0);
            raySide.rotation.z = Math.PI / 2;
            components.usSide.add(raySide);
            robot.add(components.usSide);
            
            // Line tracking module
            components.irLine = new THREE.Group();
            const lineGeo = new THREE.BoxGeometry(0.15, 0.05, 0.12);
            const lineMat = new THREE.MeshLambertMaterial({ color: 0x2c3e50 });
            const lineModule = new THREE.Mesh(lineGeo, lineMat);
            lineModule.position.set(0, 0.05, 1.4);
            lineModule.castShadow = true;
            components.irLine.add(lineModule);
            
            // Sensores IR del line tracking
            const irGeo = new THREE.CylinderGeometry(0.025, 0.025, 0.04, 8);
            const irMat = new THREE.MeshLambertMaterial({ color: 0xe74c3c });
            
            // Geometría para rayos IR
            const irRayGeo = new THREE.CylinderGeometry(0.005, 0.005, 0.5, 8);
            const irRayMat = new THREE.MeshBasicMaterial({ 
                color: 0xff6b6b, 
                transparent: true, 
                opacity: 0.7 
            });
            
            for (let i = -1; i <= 1; i++) {
                const irSensor = new THREE.Mesh(irGeo, irMat);
                irSensor.position.set(i * 0.05, 0.02, 1.45);
                irSensor.castShadow = true;
                components.irLine.add(irSensor);
                
                // Rayo IR hacia abajo
                const irRay = new THREE.Mesh(irRayGeo, irRayMat);
                irRay.position.set(i * 0.05, -0.23, 1.45);
                components.irLine.add(irRay);
            }
            robot.add(components.irLine);
            
            // IR lateral
            components.irSide = new THREE.Group();
            const irSideSensor = new THREE.Mesh(irGeo, irMat);
            irSideSensor.position.set(1.12, 0.18, 0);
            irSideSensor.rotation.z = Math.PI / 2;
            irSideSensor.castShadow = true;
            components.irSide.add(irSideSensor);
            
            const irSideRay = new THREE.Mesh(irRayGeo, irRayMat);
            irSideRay.position.set(1.37, 0.18, 0);
            irSideRay.rotation.z = Math.PI / 2;
            components.irSide.add(irSideRay);
            robot.add(components.irSide);
            
            // IR inferior
            components.irDown = new THREE.Group();
            const irDownSensor = new THREE.Mesh(irGeo, irMat);
            irDownSensor.position.set(0, 0.05, -1.0);
            irDownSensor.castShadow = true;
            components.irDown.add(irDownSensor);
            
            const irDownRay = new THREE.Mesh(irRayGeo, irRayMat);
            irDownRay.position.set(0, -0.23, -1.0);
            components.irDown.add(irDownRay);
            robot.add(components.irDown);
            
            // Cámara
            components.camera = new THREE.Group();
            const camGeo = new THREE.BoxGeometry(0.15, 0.1, 0.08);
            const camMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            const camSensor = new THREE.Mesh(camGeo, camMat);
            camSensor.position.set(0, 0.6, 1.6);
            camSensor.castShadow = true;
            components.camera.add(camSensor);
            
            // Campo de visión
            const camRayGeo = new THREE.ConeGeometry(0.3, 1.5, 8);
            const camRayMat = new THREE.MeshBasicMaterial({ 
                color: 0xffff00, 
                transparent: true, 
                opacity: 0.3,
                wireframe: true
            });
            const camRay = new THREE.Mesh(camRayGeo, camRayMat);
            camRay.position.set(0, 0.6, 2.35);
            camRay.rotation.x = Math.PI / 2;
            components.camera.add(camRay);
            robot.add(components.camera);
            
            // Rayos (grupo para toggle)
            components.rays = new THREE.Group();
            components.usFront.children.forEach(child => {
                if (child.material && child.material.transparent) {
                    components.rays.add(child);
                }
            });
        }
        
        function createGround() {
            const groundGeo = new THREE.PlaneGeometry(20, 20);
            const groundMat = new THREE.MeshLambertMaterial({ 
                color: 0x7f8c8d,
                transparent: true,
                opacity: 0.8
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.5;
            ground.receiveShadow = true;
            scene.add(ground);
            
            const grid = new THREE.GridHelper(20, 20, 0x34495e, 0x34495e);
            grid.position.y = -0.49;
            scene.add(grid);
        }
        
        function setupControls() {
            // Mouse controls
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            
            // Button controls
            document.getElementById('btn-us-front').addEventListener('click', () => toggleComponent('usFront'));
            document.getElementById('btn-us-side').addEventListener('click', () => toggleComponent('usSide'));
            document.getElementById('btn-ir-line').addEventListener('click', () => toggleComponent('irLine'));
            document.getElementById('btn-ir-side').addEventListener('click', () => toggleComponent('irSide'));
            document.getElementById('btn-ir-down').addEventListener('click', () => toggleComponent('irDown'));
            document.getElementById('btn-servos').addEventListener('click', () => toggleComponent('servos'));
            document.getElementById('btn-motors').addEventListener('click', () => toggleComponent('motors'));
            document.getElementById('btn-camera').addEventListener('click', () => toggleComponent('camera'));
            document.getElementById('btn-rays').addEventListener('click', toggleRays);
            document.getElementById('btn-labels').addEventListener('click', toggleLabels);
        }
        
        function onMouseDown(event) {
            isMouseDown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
        }
        
        function onMouseUp() {
            isMouseDown = false;
        }
        
        function onMouseMove(event) {
            if (!isMouseDown) return;
            
            const deltaX = event.clientX - mouseX;
            const deltaY = event.clientY - mouseY;
            
            robotRotationY += deltaX * 0.01;
            robotRotationX += deltaY * 0.01;
            
            mouseX = event.clientX;
            mouseY = event.clientY;
        }
        
        function onMouseWheel(event) {
            const scale = event.deltaY > 0 ? 1.1 : 0.9;
            camera.position.multiplyScalar(scale);
        }
        
        function toggleComponent(componentName) {
            const component = components[componentName];
            if (component) {
                component.visible = !component.visible;
                const button = document.getElementById('btn-' + componentName.replace(/([A-Z])/g, '-$1').toLowerCase());
                if (button) {
                    button.classList.toggle('active');
                }
            }
        }
        
        function toggleRays() {
            const button = document.getElementById('btn-rays');
            const rayComponents = [components.usFront, components.usSide, components.irLine, components.irSide, components.irDown];
            
            rayComponents.forEach(comp => {
                if (comp && comp.children) {
                    comp.children.forEach(child => {
                        if (child.material && child.material.transparent) {
                            child.visible = !child.visible;
                        }
                    });
                }
            });
            
            button.classList.toggle('active');
        }
        
        function toggleLabels() {
            const button = document.getElementById('btn-labels');
            button.classList.toggle('active');
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Smooth rotation
            robot.rotation.y += (robotRotationY - robot.rotation.y) * 0.05;
            robot.rotation.x += (robotRotationX - robot.rotation.x) * 0.05;
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize);
        
        // Initialize
        init();
    </script>
</body>
</html>
